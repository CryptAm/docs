---
title: "Использование балансов Coinbase в ончейн-среде"
description: "Как использовать балансы Coinbase в ончейн-среде с помощью Base Account"
---

Благодаря функции MagicSpend пользователи Base Account могут использовать свои балансы Coinbase в ончейн-операциях. Это означает, что пользователи могут легко начать использовать ончейн-приложения без необходимости пополнять баланс (onramp) в своем кошельке.

Это также означает, что приложениям может быть недоступна вся информация о балансе, которая обычно получается путем чтения ончейн-данных. Base Account указывает на это, отвечая на [RPC-запросы `wallet_getCapabilities`](https://eip5792.xyz/reference/getCapabilities) возможностью (capability) `auxiliaryFunds` для каждой цепи, на которой пользователи Base Account могут использовать свои балансы Coinbase.

Если ваше приложение поддерживает Base Account, оно не должно предполагать, что знает все доступные пользователю балансы, если для данной цепи присутствует возможность `auxiliaryFunds`. Например, если ваше приложение отключает кнопку транзакции, когда видит, что в кошельке недостаточно средств, оно должно учитывать `auxiliaryFunds` и активировать кнопку, если у аккаунта есть `auxiliaryFunds` в цепи, где пользователь совершает транзакцию.

## Почему это важно

MagicSpend упрощает вовлечение пользователей, позволяя им оплачивать комиссии или отправлять средства, даже когда баланс их ончейн-кошелька равен **нулю**. Следовательно, ваш интерфейс _никогда_ не должен отключать действие только из-за недостаточного ончейн-баланса.


1. Убедитесь, что `address` пользователя сохранен в состоянии вашего компонента (из вашего потока подключения кошелька).

2. Добавьте приведенный ниже компонент в ваш интерфейс. Он проверит, доступна ли MagicSpend (`auxiliaryFunds`) для данного адреса на Base, и в противном случае соответствующим образом отключит кнопку отправки.

```tsx title="SendButton.tsx"
import { useEffect, useState } from "react";
import { createBaseAccountSDK, base } from "@base-org/account";

const sdk = createBaseAccountSDK({
  appName: "Magic Spend Demo",
  appLogoUrl: "https://base.org/logo.png",
  appChainIds: [base.constants.CHAIN_IDS.base],
});

const provider = sdk.getProvider();

interface Props {
  address?: string; // адрес кошелька из состояния вашего приложения
}

export function SendButton({ address }: Props) {
  const [hasAuxFunds, setHasAuxFunds] = useState<boolean | null>(null);

  useEffect(() => {
    if (!address) return; // Кошелек еще не подключен

    (async () => {
      try {
        const capabilities = await provider.request({
          method: "wallet_getCapabilities",
          params: [address],
        });
        const supported =
          capabilities?.[base.constants.CHAIN_IDS.base]?.auxiliaryFunds
            ?.supported ?? false;
        setHasAuxFunds(supported);
      } catch (err) {
        console.error("wallet_getCapabilities failed", err);
        setHasAuxFunds(false);
      }
    })();
  }, [address]);

  const disabled = hasAuxFunds !== true;

  return (
    <button disabled={disabled} onClick={() => console.log("Send!")}>
      {hasAuxFunds ? "Send Transaction" : "Insufficient Balance"}
    </button>
  );
}
```

### Что делает этот код

1. Получает текущий `address` из вашей собственной логики работы с кошельком.
2. Вызывает `wallet_getCapabilities` при каждом изменении адреса.
3. Считывает `auxiliaryFunds.supported` для цепи Base (`8453`).
4. Активирует кнопку, когда MagicSpend доступен; в противном случае показывает "Недостаточно средств".

## Base Pay интегрирует Magic Spend по умолчанию

Благодаря [Magic Spend](/base-account/improve-ux/magic-spend), [Base Pay](/base-account/guides/accept-payments) позволяет пользователям по умолчанию оплачивать с помощью своего баланса USDC на Coinbase.

<div style={{ display: 'flex', justifyContent: 'center' }}>
  <img src="/images/base-account/CoinbaseSpend.png" alt="Pay with Coinbase on Base Account" style={{ width: '300px', height: 'auto' }} />
</div>
---

## Следующие шаги

- Обрабатывайте состояния загрузки/ошибок, если требуется детальный контроль над пользовательским опытом
- Объедините эту проверку с вашей существующей логикой проверки ончейн-баланса для резервных сценариев

